#!/bin/bash

# ## ### ##### ########
# System-init the second:
# 	Installs flathub packages and direct install media packages
# 	Installs hobby packages
# Ensure the machine has been restarted since adding the flathub repo.
# ## ###

set -e

# List packages -----------------------

PYTHON_PACKAGES=(
	pipx qmk
)

FLATHUB_PACKAGES=(
  com.github.tchx84.Flatseal
  com.discordapp.Discord
  org.kde.krita
)

# Package Installs --------------------
# Python and Pipx
for app in "${PYTHON_PACKAGES[@]}"; do
  python3 -m pip install --user $app
done
pipx install git+https://github.com/caksoylar/keymap-drawer.git

# Flathub Installs
for app in "${FLATHUB_PACKAGES[@]}"; do
  flatpak install flathub $app
done

# Direct installs: calibre
echo "downloading calibre..."
sudo -v && wget -nv -O- https://download.calibre-ebook.com/linux-installer.sh | sudo sh /dev/stdin

# Keyboard Environment ----------------

# Set up repositories 
repos_dir=$HOME/repos
mkdir -p repos_dir && cd repos_dir

git clone git@github.com:possumvibes/keyboard-layout.git
git clone --recurse-submodules git@github.com:possumvibes/qmk_firmware.git

## Configure QMK 
cd $repos_dir/qmk_firmware
git checkout possumdev

# configure ye olde defaults
qmk config user.keyboard=ferris/sweep
qmk config user.keymap=possumvibes
qmk config user.name=possumvibes

qmk compile

