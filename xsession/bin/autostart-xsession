#!/bin/bash

## XOrg AutoStart Script #####################
#

_check()
{
  command -v "$1" > /dev/null
}

[ -n "$SESSION_AUTOSTARTED" ] && exit 0

$SESSION_AUTOSTARTED=true

## Sound
_check pipewire && pipewire &

## Disk auto-mounting
# -a auto-mount, -n notify, -t tray icon
_check udiskie && udiskie -ant &

# Screensaver
xset s 300 5
_check xss-lock && xss-lock -l -- lockscreen &

## Compositor
_check picom && picom &

## Blue light shift
_check redshift &&  redshift &

# Load Xresources
xrdb -I "$HOME" -merge "$HOME"/.Xresources

# WM-specific config
#
if [ "$DESKTOP_SESSION" == "bspwm" ]; then

  # hotkey daemon
  _check sxhkd && env SXHKD_SHELL='sh' sxhkd

	# notifications
  _check dunst && dunst &

  # wallpaper!
  _check feh && [ -f ~/.fehbg ] && ~/.fehbg &

  if _check polybar
  then
    # Make sure there are no running instances
    pkill -x polybar

    ## Restart the sucker
    ~/.config/polybar/launch.sh &
  fi
fi

